前端设计指南 — 数学竞赛在线学习平台（教师客户端）

> 版本：v0.2（面向前端可交互原型交付）
> 更新时间：2026-01-10

---

# 一、结论先行（这份文档要解决什么）

本文档覆盖了“页面清单 / 关键交互 / API 映射 / 数据模型 / 交付物”的骨架。
为了让前端能把 Stitch 原型与静态 HTML 快速落地为“真实可交互原型”，本指南补强：

1. 设计原则与约束（tokens / spacing / 可访问性 / 动效规则）
2. 共享组件契约（可直接复制的 TypeScript props 简版）
3. 页面 → API → 字段映射（支持 mock 服务与后端切换）
4. 关键长事务状态机（直播、录制转码、批改提交）
5. Mock 数据模板与验收标准（明确“做到什么程度算完成”）

---

# 二、设计原则与实现约束（必须）

## 2.1 Design Tokens（建议落到 Tailwind theme 或 CSS 变量）

```css
--color-primary: #0A6EF0;
--color-primary-600: #0A58D6;
--color-bg: #F6F7F8;
--color-surface: #FFFFFF;
--color-text: #0D141B;
--color-muted: #6B7280;

--card-radius: 8px;

--space-xs: 4px;
--space-sm: 8px;
--space-md: 16px;
--space-lg: 24px;

--shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
--shadow-md: 0 8px 24px rgba(0,0,0,0.06);

--motion-fast: 120ms;
--motion-medium: 200ms;
```

## 2.2 可访问性与交互一致性约束

- 所有可点击元素必须有：`hover`、`focus-visible`、`disabled` 状态。
- 重要操作必须二次确认：删除、结束直播、提交批改、批量操作。
- 所有页面至少具备：`loading / error / empty / ready` 四态。

---

# 三、页面架构（信息架构清单）

1. 教师工作台（dashboard）基础视图（今日课程、直播入口、待批改、教学数据卡片、快捷操作）
2. 直播准备页（课程信息、白板连接测试、素材上传）
3. 直播进行中（Teacher view）——含主显示区、白板嵌入、学生列表、举手/点名、录制按钮、聊天、互动题发起入口
4. 作业批改工作台（作业列表 + 单份批改三栏布局）
5. 习题管理（习题列表、创建/编辑页面、预览 modal）
6. 学生管理（班级列表、学生详情/学习进度）
7. 简洁的数据统计卡片（dashboard 中的图表面板）
8. 登录/个人中心/切换角色/通知面板
9. 直播后处理（录制转码状态、回放管理、课程归档）
10. 批量导入导出、Excel 模板、审核流程（题目审核）
11. 互动工具原型（投票、随堂练习、即时答题 UI）
12. 白板高级：协作权限、图层/版本、几何模板、学生协作权限控制
13. 语音点评、手写识别展示、错题本集成
14. 个人教学资料库、知识胶囊市场、AI 智能作业/批改建议、课堂教学智能预警与推荐

---

# 四、Figma 要画的页面清单（每项后面标注必须包含的**状态**）

把下面每个页面都做成 Figma 帧（Frame），并为每个帧设计以下状态：`默认/正常`、`空态`、`加载态`、`错误态`、（需要时）`确认模态`、`成功Toast`。

1. `Login / Register` — 登录、注册、找回密码（若不做找回，显示提示）
   * 状态：表单、错误提示、成功跳转

2. `Teacher Dashboard`（teacher-dashboard）
   * 状态：正常（有今日课程+未批改+图表）、空态、加载、权限切换后视图

3. `Course Detail`（课程详情） — 包含章节、直播/回放、资料、学生列表入口
   * 状态：无课程/无章节、正常、加载

4. `Live Prepare`（直播准备）
   * 必做项：课程信息、白板连接测试、PPT上传、生成/复制会议链接、习题预设、互动题设置
   * 状态：未配置、已通过测试、硬件异常提示（麦/摄像/网络）

5. `Live Teaching - Teacher View`（核心）
   * 必做项：四宫格主区（video/whiteboard/materials/interaction）、学生侧边栏（在线/举手/点名）、控制条（录制、共享、音视频）、聊天、实时指标（延迟/丢帧）、白板工具条
   * 状态：直播进行中、直播暂停、录制中、网络异常提示、学生网络异常/掉线提示

6.`Live Teaching - Student View`（简化留白，便于教师端测试）

7. `Recording / Replays`（录制管理） — 转码进度、回放列表、权限设置
   * 状态：转码中、可回放、转码失败（重试）

8. `Problem Management - List`（习题库列表）
   * 状态：筛选、表格、空列表、导入成功/失败提示

9. `Problem Editor`（create/edit） — 富文本、LaTeX 编辑器、图片上传、视频解析上传、发布/草稿/审核流程
   * 状态：编辑、预览（modal）、保存草稿、提交审核

10. `Grading Workspace - Assignment List`（作业列表）
* 状态：筛选、排序、没有作业、加载

11. `Grading Workspace - Single Grading`（批改详情三栏）
* 状态：草稿保存、提交、语音点评、标注/圈划工具、手写识别结果（若集成则展示）

12. `Student Management`（班级/学生详情/学习进度）
* 状态：班级空、学生详情页（学习轨迹、错题、出勤）

13. `Analytics / Reports`（班级/学生/题目统计）
* 状态：时间筛选、导出报表、空数据提示

14.`Settings / Profile`（账户、通知、直播设备默认设置）

15.`Notification Center / Message Drawer`（右上角）
* 状态：有/无未读、过滤（系统/课程/作业）

16.`Bulk Import`（习题/学生 Excel 导入） — 模板下载、上传进度、解析日志


17.`Moderation / Audit`（题目/课程审核页面）

18.`Help / Guided Tour`（教师新手引导步骤）

19.`Whiteboard Admin`（白板版本/板书回放管理）

20.`Billing / Subscriptions`（付费课程）

---

# 五、每个页面的关键交互 & 文案

* CTA 文案统一：`开始直播` / `结束直播` / `保存草稿` / `提交批改` / `下载 CSV` / `导出报告`
* 重要提示文案示例：

  * 直播开始前：`检测到摄像头异常，请检查摄像头权限`（错误态）
  * 批量导入：`文件解析中，请稍候（进度 xx%）`
  * 提交批改确认：`确认提交？提交后学生将收到通知并可查看成绩`（确认模态）
* 空态文案示例：`暂无未批改作业。试试在“作业管理”创建一份作业。`

---

# 六、必须在原型中体现的交互细节（工程实现所需）

1. **实时提示与延迟处理**：直播中显示“网络延迟/丢包”提示，示范断线重连流程。
2. **白板权限切换**：示意“教师主控 / 学生可协作 / 学生仅可观看”三种模式的 UI 变化。
3. **录制状态流**：开始→录制中（红点）→保存→转码中→回放可用→删除/下载。
4. **批注工具**：画笔/橡皮/文本/颜色/撤销/重做/保存为图片。
5. **批改流水线**：列表→打开→标注→保存草稿→最终提交（并触发学生通知）。
6. **多级筛选 + 高级过滤**：习题管理、作业筛选支持多维过滤（课程/难度/知识点/发布时间）。
7. **导入/导出进度与日志**：成功/失败条目展示、错误行号、重复检测。
8. **确认与回退机制**：重要操作（删除题目/批量操作/提交成绩）都需确认且可撤回（或有操作日志）。
9. **移动响应简化页**：关键页面需绘制 mobile / tablet 的简化版本（dashboard、直播入口、通知、作业列表）。

---

# 七、共享组件接口（必须，面向前端工程）

目的：让前端以“组件契约”为中心，把静态 HTML/原型快速改造成可复用组件与可交互页面。

> 说明：以下为 TypeScript 风格简版 props，可直接复制到工程中作为契约基线。

## 7.1 CourseCard

```ts
type CourseStatus = 'live' | 'upcoming' | 'ended' | 'paused'

export interface CourseCardProps {
   course?: Course // 优先使用

   // legacy fields（兼容 Stitch 导出的静态字段，迁移期可保留）
   id?: string
   title?: string
   classLabel?: string
   timeRange?: string
   studentsCount?: number
   status?: CourseStatus

   onEnter?: (courseId: string) => void
   onMore?: (courseId: string) => void
}
```

## 7.2 RecordingCard

```ts
export interface RecordingCardProps {
   id: string
   title: string
   duration?: number // seconds
   status: 'processing' | 'ready' | 'failed'
   thumbnailUrl?: string
   onPlay?: (id: string) => void
   onShare?: (id: string) => void
   onExport?: (id: string) => void
}
```

## 7.3 AssignmentItem

```ts
export interface AssignmentItemProps {
   id: string
   courseId: string
   title: string
   dueAt?: string
   submissionsCount?: number
   status: 'draft' | 'published' | 'closed'
   onClick?: (id: string) => void
   onAction?: (action: string, id: string) => void
}
```

## 7.4 StudentRow

```ts
export interface StudentRowProps {
   student: Student
   selectable?: boolean
   onViewProfile?: (id: string) => void
   onAttendanceChange?: (id: string, status: 'present' | 'absent') => void
}
```

## 7.5 MetricCard

```ts
export interface MetricCardProps {
   keyName: string
   label: string
   value: number | string
   unit?: string
   progress?: number // 0-100
   color?: string
}
```

---

# 八、交互状态机（高优先）

目的：直播、录制转码、批改提交属于“长事务”，必须明确状态与边界，避免实现时出现不可控分支。

## 8.1 Live 流程状态机（关键）

```
PREPARE (device check) -> START -> LIVE (recordingOn? yes/no)
   -> END -> RECORDING_PROCESSING -> RECORDING_READY | RECORDING_FAILED

Transitions:
- PREPARE.confirm -> START
- START.end -> END
- END.triggerRecording -> RECORDING_PROCESSING
- RECORDING_PROCESSING.poll -> RECORDING_READY / RECORDING_FAILED
```

实现建议：

- 后端返回 `recording_id + status`；前端对 `recording_id` 轮询 `GET /api/recordings/{id}`。
- 轮询节奏建议：2s → 5s → 10s（指数退避），失败可手动重试。

## 8.2 批改提交状态（草稿 / 最终提交）

- 草稿保存：`POST /api/assignments/{id}/grade/draft`
- 最终提交：`POST /api/assignments/{id}/grade`
- UI 状态：
   - `idle -> savingDraft -> draftSaved | error`
   - `idle -> submitting -> submitted | error`

---

# 九、Mock 数据与 JSON 模板（马上需要）

目的：前端拿到一份 `mock/data.json` 就能把静态页面绑定为可点可跳的原型，并能在后端未就绪时完成主流程。

## 9.1 Minimal mock/data.json（示例）

```json
{
  "users": [
    { "id": "u1", "name": "张老师", "role": "teacher", "avatar": "", "last_login": "2026-01-09T08:12:00+08:00" },
    { "id": "u2", "name": "系统管理员", "role": "admin", "avatar": "", "last_login": "2026-01-05T11:02:00+08:00" }
  ],
  "teachers": [
    { "user_id": "u1", "subjects": ["数学"], "bio": "数学竞赛教练", "rating": 4.8 }
  ],
  "students": [
    { "id": "s001", "name": "张三", "avatar": "", "classId": "class-A", "overallScore": 87, "attendanceStatus": "present" },
    { "id": "s002", "name": "李四", "avatar": "", "classId": "class-A", "overallScore": 74, "attendanceStatus": "absent" },
    { "id": "s003", "name": "王五", "avatar": "", "classId": "class-B", "overallScore": 92, "attendanceStatus": "present" }
  ],
  "classes": [
    { "id": "class-A", "name": "高一A班" },
    { "id": "class-B", "name": "初三集训" }
  ],
  "courses": [
    {
      "id": "course-001",
      "title": "数学竞赛训练 — 高一提升",
      "teacher_id": "u1",
      "class": "高一A班",
      "schedule": [{ "session_id": "sess-1001", "start_time": "2026-01-12T19:00:00+08:00", "end_time": "2026-01-12T20:30:00+08:00" }],
      "chapters": ["数论基础", "同余方程"],
      "default_duration_minutes": 90,
      "students_count": 32,
      "next_session": "2026-01-12T19:00:00+08:00",
      "status": "upcoming"
    },
    {
      "id": "course-002",
      "title": "初三奥数集训营",
      "teacher_id": "u1",
      "class": "初三集训",
      "schedule": [{ "session_id": "sess-1002", "start_time": "2026-01-12T14:00:00+08:00", "end_time": "2026-01-12T16:00:00+08:00" }],
      "chapters": ["几何技巧"],
      "default_duration_minutes": 120,
      "students_count": 40,
      "next_session": "2026-01-12T14:00:00+08:00",
      "status": "live"
    }
  ],
  "live_sessions": [
    {
      "id": "live-9001",
      "course_id": "course-002",
      "start_time": "2026-01-12T14:00:00+08:00",
      "status": "live",
      "recording_id": null
    }
  ],
  "recordings": [
    {
      "id": "rec-001",
      "title": "数学竞赛训练 2026-01-05",
      "course_id": "course-001",
      "duration_seconds": 3600,
      "status": "ready",
      "thumbnailUrl": "",
      "created_at": "2026-01-05T20:30:00+08:00",
      "play_url": ""
    },
    {
      "id": "rec-002",
      "title": "初三奥数集训 2026-01-12 (processing)",
      "course_id": "course-002",
      "duration_seconds": 0,
      "status": "processing",
      "thumbnailUrl": "",
      "created_at": "2026-01-12T16:05:00+08:00",
      "play_url": ""
    }
  ],
  "problems": [
    { "id": "p001", "title": "数论基本题", "difficulty": "medium", "tags": ["数论"], "content_html": "<p>求解…</p>", "latex": "" },
    { "id": "p002", "title": "平面几何综合", "difficulty": "hard", "tags": ["几何"], "content_html": "<p>证明…</p>", "latex": "" }
  ],
  "assignments": [
    {
      "id": "assign-101",
      "course_id": "course-001",
      "title": "第三章：平面几何综合练习",
      "description": "请完成以下题目",
      "dueAt": "2026-01-15T23:59:00+08:00",
      "totalPoints": 100,
      "status": "published",
      "submissionsCount": 8,
      "created_at": "2026-01-10T10:00:00+08:00"
    },
    {
      "id": "assign-102",
      "course_id": "course-002",
      "title": "数论：同余方程组强化训练",
      "description": "练习同余方程",
      "dueAt": "2026-01-20T23:59:00+08:00",
      "totalPoints": 100,
      "status": "draft",
      "submissionsCount": 4,
      "created_at": "2026-01-11T09:00:00+08:00"
    }
  ],
  "submissions": [
    {
      "id": "sub-5001",
      "assignment_id": "assign-101",
      "student_id": "s001",
      "files": [],
      "status": "submitted",
      "grade": null,
      "submitted_at": "2026-01-13T20:12:00+08:00"
    }
  ],
  "grades": [
    {
      "id": "g001",
      "submission_id": "sub-5001",
      "grader_id": "u1",
      "score": null,
      "feedback": null,
      "created_at": "2026-01-13T21:00:00+08:00"
    }
  ],
  "dashboard": {
    "metrics": [
      { "key": "participation", "label": "参与率", "value": 92, "unit": "%" },
      { "key": "accuracy", "label": "正确率", "value": 78, "unit": "%" },
      { "key": "hands", "label": "举手数", "value": 5, "unit": "人" }
    ],
    "today_courses": ["course-001", "course-002"]
  },
  "reports": [],
  "imports": []
}

```

## 9.2 Mock/Real 切换约定（建议）

- 环境变量：`VITE_USE_MOCK=true`
- Service 约定：页面只依赖统一的 service 接口（mock 与 real 仅替换实现）

---

# 十、验收标准 / 测试建议（必须）

目的：定义“可交互原型达成”的最低标准，避免只停留在静态页面拼接。

## 10.1 页面级验收（示例）

- Dashboard：点击课程卡 → 跳转 `/courses/:id`，CourseDetail 正常渲染（数据来自 mock）
- Start Live：Dashboard → CourseDetail → 点击“开始直播” → 设备自检 → 确认后进入直播页
- End Live：结束直播 → 返回 CourseDetail 的 Recordings，出现 status=processing，随后变为 ready，点击 Play 打开回放

## 10.2 自动化建议（可选但推荐）

- Playwright：以用户主路径为主（登录/仪表盘/课程/直播/结束/回放）
- CI 最小守门：Smoke 用例 + 基础可访问性（tab/focus）检查

---

# 十一、后端 API 映射

下面给出精简且工程可用的 API 列表（REST 风格）。每个动作都应标明调用哪个 API。

**认证**

* `POST /api/auth/login` — 登录
* `POST /api/auth/logout` — 登出
* `POST /api/auth/register` — 教师注册 / 邀请链接

**课程 / 直播**

* `GET /api/teachers/{id}/dashboard` — Dashboard 数据（今日课程、待批改数、卡片统计）
* `GET /api/courses/{course_id}` — 课程详情
* `POST /api/courses/{course_id}/live/start` — 开始直播（返回 live_id）
* `POST /api/live/{live_id}/stop` — 结束直播
* `GET /api/live/{live_id}/stats` — 实时/结束后统计

**白板 / 实时**

* WebSocket `wss://.../live/{live_id}/ws` — 白板同屏、互动事件、举手、出勤事件
* `POST /api/live/{live_id}/record` — 请求保存白板快照/回放

**习题管理**

* `GET /api/problems` — 列表（支持 filter）
* `POST /api/problems` — 创建
* `PUT /api/problems/{id}` — 编辑
* `POST /api/problems/batch-import` — 批量导入（返回 job_id）
* `GET /api/problems/import/{job_id}` — 导入状态与日志

**作业 & 批改**

* `GET /api/assignments` — 作业列表（filter）
* `GET /api/assignments/{id}` — 作业详情与提交列表
* `POST /api/assignments/{id}/grade` — 提交批改（含批注、语音点评 URL）
* `POST /api/assignments/{id}/grade/draft` — 保存草稿

**学生与班级**

* `GET /api/classes/{id}/students` — 班级学员列表
* `GET /api/students/{id}/progress` — 学习轨迹/成绩分布

**导出 / 报表**

* `GET /api/reports/class/{id}` — 导出班级报告（CSV / PDF）
* `POST /api/reports/generate` — 异步报告生成（返回 job_id）

**文件 / 资源**

* `POST /api/uploads` — 上传 PPT / 讲义 / 视频（返回 URL 或 media_id）
* `GET /api/media/{id}` — 获取 media 信息


# 十二、数据模型草案（简化版，便于前端使用 Mock 数据）

* `User { id, name, role, avatar, last_login }`
* `TeacherProfile { user_id, subjects, bio, rating }`
* `Course { id, title, teacher_id, schedule, chapters[] }`
* `LiveSession { id, course_id, start_time, end_time, status, record_url }`
* `Problem { id, title, content_html, latex, difficulty, tags[] }`
* `Assignment { id, course_id, due_date, problems[] }`
* `Submission { id, assignment_id, student_id, files[], status, grade }`
* `Grade { id, submission_id, grader_id, score, feedback }`
* `WhiteboardEvent { live_id, user_id, type, payload, timestamp }`
* `AnalyticsSnapshot { class_id, metric, value, timestamp }`

---

# 十三、组件库与复用清单

建议先建立一套组件库（可复用），Design Tokens 以第 2 章为准。

**组件建议清单**

* Header / Nav / Breadcrumb
* Card (3 sizes)
* Table with actions + selectable rows
* Modal / Confirm / Toast
* Button primary / secondary / ghost / danger
* Form components：input、textarea、select、file uploader、rich text editor placeholder
* Whiteboard tool palette mock (icons for pen/eraser/shape/text/undo/redo)
* Student list item / avatar + status dot

---

# 十四、可交付的产物清单

1. 每个页面的高保真帧（含四个响应宽度：desktop 1440、tablet 1024、mobile 375）
2. 组件库 page（Tokens、按钮、表格、表单、modals、白板控制）
3. 交互链接（Prototype mode）覆盖主要流程：进入直播→开始→互动→结束→回放
4. 导航与状态说明文档
5. Mock data JSON（方便前端用 mock server 接口填充）

---

# 十五、UX / 可用性与可访问性要点（必须在原型中体现）

* 所有交互要有加载态/失败态/成功反馈。
* 关键操作（提交成绩、删除题目、结束直播）要有确认与二次提示。
* 可访问性：颜色对比、键盘操作（Tab 顺序）、焦点态样式（outline）、图片 alt 文本。
* 响应式：直播页在小屏时隐藏部分侧栏，保留关键功能（聊天、举手、退出）。
* 国际化占位（支持中文/英文文案替换的文本样式）。

---

# 十六、交付优先级的具体行动清单

**马上做（1–2 天）**

* 在 Figma 建立 `Components` page 与 tokens。
* 绘制 `Teacher Dashboard`（含卡片、图表占位）与 `Live Prepare` 两页，包含空态/加载/错误。
* 绘制 `Live Teaching - Teacher View` 的 Desktop 高保真帧（含白板、学生侧栏、控制条）。

**接着做（3–7 天）**

* 完成 `Grading Workspace`（列表 + 单条批改）与 `Problem Editor`。
* 画出 `Student Management` 与 `Analytics` 页面。
* 为关键动作标注 API 调用（在 Figma 注释或单独的 spec 页）。

**交付后**

* 导出组件规范与 Mock JSON，提交给前端实现。

---

# 十七、必须补强：数据契约（JSON Schema / response 示例）

目标：让 mock 与真实接口切换“无痛”，避免字段错位导致页面联调反复。

建议把 JSON Schema 作为 contract-first 基线，落地到仓库 `spec/schemas/`：

- `spec/schemas/course.json`
- `spec/schemas/recording.json`
- `spec/schemas/assignment.json`
- `spec/schemas/submission.json`

约定：

- `mock/data.json`（或 `src/data/mock/data.json`）必须与 schema 对齐。
- 页面 / hooks / services 层的字段映射以 schema 为准（字段名不随 UI 文案变化）。

---

# 十八、必须补强：WebSocket 事件协议与重连策略（直播白板 / 互动事件）

目标：把“实时能力”变成可联调、可 mock 的稳定协议，避免各端实现发散。

协议文档见：

- `spec/ws-live.md`

建议最小实现覆盖：`join/leave`、`whiteboard:update/patch`、`raise_hand`、`question:open`、`recording:status`，以及断线重连（指数退避）。

---

# 十九、工程补强：Tailwind tokens 片段（工程可复制）

目标：将第 2 章 tokens 以工程配置方式固化，减少“到处写魔法值”。

可直接拷贝片段见：

- `spec/tailwind-tokens.md`

---

# 二十、工程补强：可访问性（ARIA / 键盘交互）可执行清单

目标：明确“哪些点必须做到”，并能在验收/测试中被复现与检查。

清单见：

- `spec/accessibility.md`

---

# 二十一、工程补强：Playwright smoke 用例骨架与 CI 守门

目标：把“可交互原型”变成可自动化回归的主路径，避免回归失控。

工程内参考：

- `playwright.config.ts`
- `src/tests/e2e/smoke.spec.ts`

建议 smoke 关注主路径（登录/仪表盘/课程/直播/结束/回放），并优先使用 `getByRole` + `name`（可访问名称）稳定定位。

---

# 二十二、下一步可直接执行的动作清单（不含时间估计）

1. 将后端响应示例补齐为“可复制的 response JSON”（至少覆盖：dashboard、course detail、start/end live、recording status）。
2. 为所有长事务统一返回 `job_id + status + progress + error` 字段约定（导入、报表、转码、考试评分队列）。
3. 按 `spec/ws-live.md` 落地前端实时层：断线提示、指数退避重连、seq/ack 基本一致性。
4. 按 `spec/accessibility.md` 做一轮关键页面自检：dialog/按钮可访问名称/tab 顺序/focus-visible。
5. 扩充 `src/tests/e2e/smoke.spec.ts`（或新增文件）覆盖：导入任务（processing->done）、报表生成（running->ready）。
6. 让 mock 数据与 schema 同步：新增字段先改 schema，再改 mock，再改 UI（contract-first）。
7. 固化工程守门规则与 code review 口径：见 `spec/engineering-rules.md`。
